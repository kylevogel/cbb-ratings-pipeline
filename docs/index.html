<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CBB Rankings Dashboard</title>
  <style>
    :root{
      --border:#e9e9e9;
      --text:#111;
      --muted:#666;
      --chip:#ddd;
      --chipActive:#111;
    }

    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      margin: 26px;
      color: var(--text);
    }

    h1{
      margin: 0 0 10px 0;
      font-size: 34px;
      letter-spacing: -0.3px;
    }

    .top{
      display:flex;
      gap:16px;
      align-items:center;
      flex-wrap:wrap;
      margin-bottom: 14px;
    }

    .tabs{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .tab{
      border:1px solid var(--chip);
      background:#fff;
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      font-size:14px;
      line-height:1;
    }
    .tab.active{ border-color: var(--chipActive); }

    .meta{
      font-size:14px;
      color:var(--muted);
      margin-left: 4px;
      white-space: nowrap;
    }

    .search{
      width: 260px;
      padding: 10px 12px;
      border:1px solid var(--chip);
      border-radius:10px;
      font-size:15px;
    }

    table{
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      margin-top: 10px;
    }

    thead th{
      font-size: 15px;
      color:#444;
      font-weight:700;
      padding: 12px 10px;
      border-bottom: 1px solid var(--border);
      white-space: nowrap;
    }

    tbody td{
      font-size: 15px;
      padding: 14px 10px;
      border-bottom: 1px solid #f2f2f2;
      vertical-align: middle;
    }

    th.num, td.num{ text-align:right; }

    /* Column sizing: keep Team+Record together, then evenly sized numeric columns */
    col.col-team   { width: 34%; }
    col.col-record { width: 10%; }
    col.col-small  { width: 9%; }

    /* Team cell styling */
    td.team{
      font-weight: 650;
      letter-spacing: -0.1px;
    }

    /* Slightly tighter on small screens */
    @media (max-width: 900px){
      h1{ font-size: 28px; }
      thead th, tbody td{ font-size: 14px; }
      col.col-team{ width: 42%; }
      col.col-record{ width: 12%; }
      col.col-small{ width: 9%; }
    }
  </style>
</head>

<body>
  <h1>CBB Rankings Dashboard</h1>

  <div class="top">
    <div class="tabs">
      <button class="tab active" data-sort="NET">NET</button>
      <button class="tab" data-sort="SOS">SOS</button>
      <button class="tab" data-sort="KenPom">KenPom</button>
      <button class="tab" data-sort="BPI">BPI</button>
      <button class="tab" data-sort="AP">AP</button>
      <span class="meta" id="updated"></span>
    </div>
    <input class="search" id="search" placeholder="Search team..." />
  </div>

  <table>
    <colgroup>
      <col class="col-team">
      <col class="col-record">
      <col class="col-small">
      <col class="col-small">
      <col class="col-small">
      <col class="col-small">
      <col class="col-small">
    </colgroup>
    <thead>
      <tr>
        <th>Team</th>
        <th class="num">Record</th>
        <th class="num">AP</th>
        <th class="num">NET</th>
        <th class="num">KenPom</th>
        <th class="num">BPI</th>
        <th class="num">SoS</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

<script>
  let rawRows = [];
  let sortKey = "NET";
  let query = "";

  function toNum(v){
    if (v === null || v === undefined) return null;
    if (typeof v === "number") return v;
    const s = String(v).trim();
    if (!s || s.toUpperCase() === "NR") return null;
    const n = Number(s);
    return Number.isFinite(n) ? n : null;
  }

  function sortRows(rows, key){
    const copy = rows.slice();
    copy.sort((a,b) => {
      const av = toNum(a[key]);
      const bv = toNum(b[key]);
      if (av === null && bv === null) return String(a.Team).localeCompare(String(b.Team));
      if (av === null) return 1;
      if (bv === null) return -1;
      if (av !== bv) return av - bv;
      return String(a.Team).localeCompare(String(b.Team));
    });
    return copy;
  }

  function filterRows(rows, q){
    if (!q) return rows;
    const t = q.toLowerCase();
    return rows.filter(r => String(r.Team || "").toLowerCase().includes(t));
  }

  function render(){
    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";
    const rows = sortRows(filterRows(rawRows, query), sortKey);

    for (const r of rows){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="team">${r.Team ?? ""}</td>
        <td class="num">${r.Record ?? ""}</td>
        <td class="num">${r.AP ?? ""}</td>
        <td class="num">${r.NET ?? ""}</td>
        <td class="num">${r.KenPom ?? ""}</td>
        <td class="num">${r.BPI ?? ""}</td>
        <td class="num">${r.SOS ?? ""}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  function setActiveTab(key){
    document.querySelectorAll(".tab").forEach(b => {
      b.classList.toggle("active", b.dataset.sort === key);
    });
  }

  document.getElementById("search").addEventListener("input", (e) => {
    query = e.target.value || "";
    render();
  });

  document.querySelectorAll(".tab").forEach(btn => {
    btn.addEventListener("click", () => {
      sortKey = btn.dataset.sort;
      setActiveTab(sortKey);
      render();
    });
  });

  fetch("data/rankings_current.json", { cache: "no-store" })
    .then(r => r.json())
    .then(data => {
      const ts = data.updated || data.last_updated || "";
      document.getElementById("updated").textContent = ts ? `Updated: ${ts}` : "";
      rawRows = Array.isArray(data.rows) ? data.rows : [];
      render();
    })
    .catch(() => {
      document.getElementById("updated").textContent = "Updated: (failed to load data)";
    });
</script>
</body>
</html>
